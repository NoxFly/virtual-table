!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.VirtualTable=e():t.VirtualTable=e()}(self,(()=>(()=>{"use strict";var t={156:function(t,e,s){var i=this&&this.__createBinding||(Object.create?function(t,e,s,i){void 0===i&&(i=s);var o=Object.getOwnPropertyDescriptor(e,s);o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,i,o)}:function(t,e,s,i){void 0===i&&(i=s),t[i]=e[s]}),o=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||i(e,t,s)};Object.defineProperty(e,"__esModule",{value:!0}),o(s(503),e),o(s(613),e)},503:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VirtualTable=void 0;class s{constructor(t,e,i={}){this.container=t,this.columns=[],this.rows=[],this.data=[],this.tree=[],this.flatten=[],this.ROW_HEIGHT=30,this.VISIBLE_ROWS_COUNT=0,this.TOTAL_VISIBLE_ROWS=0,this.tbodyStartY=0,this.lastHighlightedRow=null,this.onDrop=()=>{},this.options=Object.assign(Object.assign({},s.DEFAULT_OPTIONS),i),this.columns=e,this.virtualScroller=document.createElement("div"),this.virtualScroller.classList.add("virtual-scroller"),this.table=document.createElement("div"),this.table.classList.add("table"),this.tableHead=document.createElement("div"),this.tableHead.classList.add("thead"),this.tableBody=document.createElement("div"),this.tableBody.classList.add("tbody"),this.table.append(this.tableHead,this.tableBody),this.container.appendChild(this.table),this.container.appendChild(this.virtualScroller),this.options.id&&(this.table.id=this.options.id),this.createColumns(),this.computeViewbox(),this.container.addEventListener("scroll",(t=>this.onScroll(t))),this.container.addEventListener("click",(t=>this.onClick(t))),this.table.style.setProperty("--row-height",this.ROW_HEIGHT+"px")}get scrollTop(){return this.container.scrollTop}get totalVirtualHeight(){return this.tableHead.clientHeight+(this.TOTAL_VISIBLE_ROWS-1)*(this.ROW_HEIGHT-1)}get columnUnits(){return this.options.columnSizeInPercentage?"%":"px"}createColumns(){const t=document.createElement("div");t.classList.add("tr");for(const e of this.columns){const s=document.createElement("div");s.classList.add("th"),s.style.width=e.width+this.columnUnits,s.textContent=e.title,t.appendChild(s)}this.tableHead.appendChild(t)}computeViewbox(){const t=this.container.clientHeight;if(this.VISIBLE_ROWS_COUNT=Math.ceil(t/this.ROW_HEIGHT)+4,this.flatten.length>0){const t=this.flatten.length,e=Math.min(t,this.VISIBLE_ROWS_COUNT);if(this.rows.length<e)for(let t=this.rows.length;t<e;t++)this.createEmptyRow();else if(this.rows.length>e)for(let t=this.rows.length-1;t>=e;t--)this.removeRow(this.rows[t])}this.tbodyStartY=this.tableHead.clientHeight-1}computeInViewVisibleRows(){this.flatten=[];const t=e=>{if(this.flatten.push({node:e}),e.expanded)for(const s of e.children)t(s)};for(const e of this.tree)t(e);this.computeViewbox(),this.updateViewBoxHeight()}updateViewBoxHeight(){this.TOTAL_VISIBLE_ROWS=this.flatten.length,console.log(this.TOTAL_VISIBLE_ROWS),this.virtualScroller.style.height=this.totalVirtualHeight+"px"}updateRowsContent(){var t;for(const e of this.rows){if(!e.node)continue;const s=e.node.children.length>0;e.$.classList.toggle("has-children",s),e.$.style.setProperty("--depth",`${e.node.depth}`);for(const i in this.columns){const o=this.columns[i],n=e.$.children.item(+i);if(n){const l=o.field?e.node.data[o.field]:void 0,a={$:e.$,value:l,row:e.node,column:o,rowIndex:e.y,columnIndex:+i},r=(null===(t=o.transform)||void 0===t?void 0:t.call(o,a))||this.formatCellValue(l);let h="";s&&"0"===i&&(h+=`<button class="btn-expand"><span class="expand-icon ${e.node.expanded?"expanded":"collapsed"}"></span></button>`),h+=`<span class="cell-value">${r}</span>`,n.innerHTML=h}}}}formatCellValue(t){return(null==t?void 0:t.toString())||""}createEmptyRow(t=!0){const e={$:document.createElement("div"),x:0,y:0};return e.$.classList.add("tr"),e.nextElement=e,e.previousElement=e,this.rows.length>0&&(e.previousElement=this.rows[this.rows.length-1],e.previousElement.nextElement=e,e.nextElement=this.rows[0],e.nextElement.previousElement=e),this.rows.push(e),this.createEmptyCells(e),t&&this.tableBody.appendChild(e.$),e}createEmptyCells(t){const e=document.createDocumentFragment();for(const t in this.columns){const s=document.createElement("div");s.classList.add("td"),s.style.setProperty("--width",this.columns[t].width+this.columnUnits),e.appendChild(s)}t.$.appendChild(e)}removeRow(t){t.$.parentNode&&t.$.remove();const e=this.rows.findIndex((e=>e===t));-1!==e&&(this.rows.splice(e,1),t.previousElement&&(t.previousElement.nextElement=t.nextElement),t.nextElement&&(t.nextElement.previousElement=t.previousElement))}setRowPosition(t,e){const s=this.tbodyStartY+e.top*(this.ROW_HEIGHT-1);t.y=e.top,t.node=this.flatten[t.y].node,t.$.dataset.index=`${t.y}`,t.$.style.setProperty("--y",s+"px")}updateScroll(){if(0===this.rows.length)return;const t=this.tbodyStartY+this.mostTopRow.y*(this.ROW_HEIGHT-1),e=t+this.ROW_HEIGHT;if(this.scrollTop>=t&&this.scrollTop<=e)return;const s=Math.max(0,Math.floor(this.scrollTop/(this.ROW_HEIGHT-1))-2);if(!(s+this.VISIBLE_ROWS_COUNT-1>=this.flatten.length)){for(let t=0;t<this.rows.length;t++){const e=this.rows[t];this.setRowPosition(e,{top:s+t,left:e.x})}this.updateRowsContent()}}onScroll(t){this.updateScroll()}onClick(t){const e=t.target,s=e.closest(".tr");e.closest(".btn-expand")&&this.toggleRowExpand(s)}toggleRowExpand(t){const e=this.rows.find((e=>e.$===t)).node;e.expanded=!e.expanded,t.classList.toggle("expanded",e.expanded);const s=this.flatten.findIndex((t=>t.node===e));if(e.expanded){const t=e.children.map((t=>this.dataToTreeNode(t.data,e.depth+1)));this.flatten.splice(s+1,0,...t.map((t=>({node:t}))));for(let e=s+1;e<s+1+t.length;e++)this.createEmptyRow(!1)}else{const t=e.children.length;this.flatten.splice(s+1,t);for(let e=0;e<t;e++)this.removeRow(this.rows[s+1])}this.updateViewBoxHeight(),this.updateScroll(),this.updateRowsContent()}resetTableRows(){for(let t=0;t<this.rows.length;t++)this.rows[t].$.remove();this.rows=[];const t=Math.min(this.flatten.length,this.VISIBLE_ROWS_COUNT),e=document.createDocumentFragment();for(let s=0;s<t;s++){const t=this.createEmptyRow(!1);e.appendChild(t.$),this.setRowPosition(t,{top:s,left:0})}this.tableBody.appendChild(e),this.rows.length>0&&(this.mostTopRow=this.rows[0].nextElement)}dataToTreeNode(t,e){return{data:t,expanded:this.options.defaultExpanded,depth:e,children:t.children?t.children.map((t=>this.dataToTreeNode(t,e+1))):[]}}scrollTo(t){this.container.scrollTo({top:this.tbodyStartY+t*(this.ROW_HEIGHT-1),behavior:"smooth"})}setData(t){this.data=t,this.tree=this.data.map((t=>this.dataToTreeNode(t,0))),this.computeInViewVisibleRows(),this.resetTableRows(),this.updateScroll()}allowColumnResizing(){}disallowColumnResizing(){}allowSelection(){}disallowSelection(){}makeDroppable(){this.container.setAttribute("dropzone","move"),this.container.addEventListener("dragover",(t=>{t.preventDefault(),t.dataTransfer.dropEffect="move";const e=t.target,s=e.closest(".tr"),i=!e.closest(".thead");s&&i&&s!==this.lastHighlightedRow?(this.lastHighlightedRow&&this.lastHighlightedRow.classList.remove("dragging-hover"),s.classList.add("dragging-hover"),this.lastHighlightedRow=s):s&&i||this.lastHighlightedRow&&(this.lastHighlightedRow.classList.remove("dragging-hover"),this.lastHighlightedRow=null)}),{capture:!0}),this.container.addEventListener("drop",(t=>{var e,s;t.preventDefault();const i=t.target.closest(".tr");console.log(t);const o=null===(e=t.dataTransfer)||void 0===e?void 0:e.getData("text/plain");null===(s=this.lastHighlightedRow)||void 0===s||s.classList.remove("dragging-hover"),this.lastHighlightedRow=null;const n=this.rows.find((t=>t.$===i));this.onDrop(o,n)}))}}e.VirtualTable=s,s.DEFAULT_OPTIONS={id:"",columnSizeInPercentage:!1,defaultExpanded:!0}},613:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0})}},e={};return function s(i){var o=e[i];if(void 0!==o)return o.exports;var n=e[i]={exports:{}};return t[i].call(n.exports,n,n.exports,s),n.exports}(156)})()));
//# sourceMappingURL=VirtualTable.min.js.map